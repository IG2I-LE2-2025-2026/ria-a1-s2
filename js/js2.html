<head>

<script>
compteur=0;
function traiter() {
	console.log("traiter : " + ++compteur); 
}
function traiter2() {
	console.log("traiter2 : " + ++compteur); 
}
function poursuivre() {
	if (compteur<=5) return true;
	else return false;
}
//boucle(5,traiter,poursuivre); 
//boucle(2,traiter2); 

/* 
// Ne fonctionne que Pour une seule boucle à la fois 
// car on utilise des var. globales !! 
var g_iPeriode;
var g_fnCbTraitement;
var g_fnCbContinuer;
function boucle(iPeriode,fnCbTraitement,fnCbContinuer) {

	if (iPeriode != undefined) {
		// premiere fois : on stocke les arguments en var. globales 
		g_iPeriode = iPeriode; 
		g_fnCbTraitement = fnCbTraitement;
		g_fnCbContinuer = fnCbContinuer;
	}

	if (g_fnCbContinuer()) {
		g_fnCbTraitement();
		setTimeout(boucle, g_iPeriode*1000);
	}

	// Objectif : déclencher un appel à la fonction fnCbTraitement
	// toutes les iPeriode secondes, 
	// tant que fnCbContinuer renvoie vrai
	
	// OBLIGATION d'utiliser window.setTimeout
	// IL FAUT POUVOIR DECLENCHER PLUSIEURS BOUCLES en parallèle 
	// => impossible de stocker de l'information en var. globale 
	// INTERDICTION d'utiliser les arguments optionnels de setTimeout
	// setTimeout(functionRef, delay) seulement 

	// fnCbTraitement est une fonction de rappel ("CALLBACK")
	// elle sera appelée plus tard
	// pour l'appeler, il suffit d'ajouter les parenthèses !

	// rendre le 3ème argument optionnel

}
*/
/*
function boucle(iPeriode,fnCbTraitement,fnCbContinuer) {

	// TODO : enfermer dans le scope de la fonction à rappeler
	// plutôt que dans des variables globales 
	// les informations de rappel 
	
	if ( (fnCbContinuer == undefined) || fnCbContinuer()) {
		fnCbTraitement();
		setTimeout(function() {
			boucle(iPeriode,fnCbTraitement,fnCbContinuer); 
		}, iPeriode*1000);
	}
}*/

function boucle(iPeriode,fnCbTraitement,fnCbContinuer) {

	// TODO : enfermer dans le scope de la fonction à rappeler
	// plutôt que dans des variables globales 
	// les informations de rappel 
	
	var foo = function () {
		// la fonction "voit" les paramètres formels de boucle !! 
		if ( (fnCbContinuer == undefined) || fnCbContinuer()) {
			fnCbTraitement();
			setTimeout(foo, iPeriode*1000);
		}
	}; 
	foo();
}

// TODO : rendre tous les arguments optionnels ! 
// Solution : passer un objet de configuration en paramètre

var oDefault = {
	periode : 5, 
	fnTraitement : function(){console.log("traitement");}, 
	fnPoursuite: function(){return true;}
}

function oBoucle(oConfig) {

}

oBoucle({periode:2}); 
oBoucle({});
oBoucle({fnTraitement:traiter});
oBoucle({fnTraitement:traiter2, fnPoursuite:poursuivre}); 

</script>
</head>
<body>


</body>










