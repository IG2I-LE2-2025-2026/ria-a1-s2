<script src="jquery-3.7.1.min.js"></script>
<script>
//var apiRoot = "http://tomnab.fr/paragraphes-api";
var apiRoot = "http://localhost/paragraphes-api-a1/api";
var hash = "a_changer"; 
 

$(document).ready(function(){
  // Clic sur bouton d'authentification => s'authentifier
  $("#btnAuthentification").click(authenticate);
});

function authenticate() {
  var pseudo = $("#pseudo").val(),
      passe = $("#passe").val();
  $.ajax({
    type: "POST",
    url: apiRoot + "/authenticate",
    headers: {"debug-data":true},
    data: {"user":pseudo,"password":passe},
    success: function(oRep){
      console.log(oRep);
      hash = oRep.hash;
      $("#authentification").hide();
      getArticle9(); 
    },
    error: function(oRep){
      console.log(oRep);
      $("#messageErreurAuthentification").show();
    },
    dataType: "json"
  });
} 

function getArticle9(){
  // Liste des paragraphes
  $.ajax({
    type: "GET",
    url: apiRoot + "/articles/9/paragraphes",
    headers: {"hash":hash,"debug-data":true},
    data: {},
    success: function(oRep){
      var p;
      console.log(oRep);
      for (var i in oRep.paragraphes) {
        p = $("<p>").html(oRep.paragraphes[i].contenu);
        $("#contenu").append(p);
      }
      $("#paragraphesArticle").show()
    },
    dataType: "json"
  });
  // Titre de l'article
  $.ajax({
    type: "GET",
    url: apiRoot + "/articles/9",
    headers: {"hash":hash,"debug-data":true},
    data: {},
    success: function(oRep){
      console.log(oRep);
      var titre = $("<h2>").html(oRep.article.titre);
      $("#contenu").before(titre);
      $("#titreArticle").show()
    },
    dataType: "json"
  });
}

function getUsers(){

  $.ajax({
    type: "GET",
    url: apiRoot + "/users",
    headers: {"hash":hash,"debug-data":true},
    data: {},
    success: function(oRep){
    console.log(oRep);

    },
    dataType: "json"
  });
}

function getArticles(){
  $.ajax({
    type: "GET",
    url: apiRoot + "/articles",
    headers: {"hash":hash,"debug-data":true},
    success: function(oRep){
      console.log(oRep);
      var idFirst = oRep.articles[0].id; 
    },
    dataType: "json"
  });
}

function postArticle(){
  $.ajax({
    type: "POST",
    url: apiRoot + "/articles",
    headers: {"hash":hash,"debug-data":true},
    data: {"titre":"Titre article"},
    success: function(oRep){
    console.log(oRep);  
    putArticle(oRep.article.id,"Titre article modifié");  
  },
  dataType: "json"
  });
}

function putArticle(id,titre){
  // NB : l'envoi de données par la méthode PUT
  // ne fonctionne pas avec la propriété .data()
  // il faut envoyer les données en QS après l'URL
  $.ajax({
    type: "PUT",
    url: apiRoot + "/articles/" + id + "?titre=" + titre,    
    headers: {"hash":hash,"debug-data":true},
    success: function(oRep){
    console.log(oRep);      
  },
  dataType: "json"
  });
}



</script>

<style>
#authentification {
  border: 2px solid gray;
  padding: 20px;
  margin: 20px;
}
#titreArticle, #paragraphesArticle {
  display: none;
}
#messageErreurAuthentification {
  display: none;
  border: 2px solid #550000;
  background-color: #ffaaaa;
}
</style>

<body>

<div id="authentification">
  <label for="pseudo">Nom d'utilisateur :</label>
  <input id="pseudo" type="text" />
  <br />
  <label for="passe">Mot de passe :</label>
  <input id="passe" type="password" />
  <br />
  <input id="btnAuthentification" type="button" value="S'authentifier" />
  <p id="messageErreurAuthentification">Erreur d'authentification !</p>
</div>

<div id="titreArticle">
</div>

<div id="paragraphesArticle">
  <div id="contenu">
  </div>
</div>

</body>








