<script src="jquery-3.7.1.min.js"></script>
<style>
#contenu, .controle {
  display:none;
}
#contenu {
  padding: 20px 20px;
}
.saisie {
  display: block;
  margin: 10px 0px;
}
</style>
<script>

// approche composant : 
// créer un composant P, 
// que l'on va utiliser ensuite

var jPeditable = $("<p>")
  .html("Nouveau");
  
var jSaisie = $("<input type='text'>")
  .addClass('saisie')
  .keydown(function(contexte){
    console.log("saisie de " + $(this).val());
    console.log(contexte); // contexte.key dénote la touche saisie
    // On utilise le contexte de l'événemnt (objet « event ») fourni par JQuery
    if (contexte.originalEvent.key === 'Enter') {
      // Valider l'édition du paragraphe
      $(this).replaceWith(
        jPeditable
        .clone()
        .html($(this).val())
      );
    }
});

// Code exécuté à la fin du chargement de la page
// Équivalent à <body onload="...">
$(document).ready(function() {
  console.log("$(document).ready");
  
  // Ajout des boutons « + »
  // <input type="button" onclick="addP(this);" value="+" class="controle"/>
  var jBoutonPlus = $('<input type="button">')
    .val('+')
    .addClass('controle')
    .click(addP);
  $('.boutonAfficherCacher').after(jBoutonPlus);
  
  // Au clic sur les boutons Afficher/Cacher
  $('.boutonAfficherCacher').click(toggle);
  
  // Au clic sur les paragraphes éditables
  // Version « on » => paragraphes actuels et futurs
  $(document).on('click', '#contenu p',
    function(){
      console.log("click sur " + $(this).html()); 
      // gestionnaire d'événement jQuery ! 
      // récupérer une référence vers l'élément 
      // cible de l'événement : $(this)
      
      var contenu = $(this).html(); 
      var jClone = jSaisie.clone(true); 
      jClone.val(contenu); 
      $(this).replaceWith(jClone);
    }
  );

});

function toggle() {
  $("#contenu").toggle("slow");
  $(".controle").toggle("slow"); 
  
  //basculer l'affichage
  // changer le label du bouton ? 
  if ($("input[value='Afficher']").length >0) 
    $("input[value='Afficher']").val("Cacher");
  else 
    $("input[value='Cacher']").val("Afficher");
}
  
function addP() {
  // conventions de nommage : 
  // refXYZ : reférence js 
  // jXYZ : collection jQuery 
  
  // comment savoir quel est le bouton cliqué ?
  // connaitre l'indice d'un élément dans une collection : https://api.jquery.com/index/
  
  // Si la fonction est appelée par JQuery,
  // $(this) contient la référence du bouton cliqué
  var refBtn = $(this);
  
  console.log($("input[value='+']").index(refBtn));
  
  // tester l'égalité entre collections
  // https://api.jquery.com/is/#is-selector 
  // $(refJS) renvoie la collection représentant l'élément refJS
  console.log(refBtn.is(
    // $("input[value='+']").first()
    $("input[value='+']:first")
  )); 

  // comment récupérer le contenu du champ texte 
  // situé à droite du bouton + ? 
  var contenu = refBtn.next().val();
  var jClone = jPeditable.clone(true);
  if (contenu != "") 
    jClone.html(contenu); 
  
  if ($("input[value='+']").index(refBtn)) {
    // 1 <=> bouton du bas
    $("#contenu").append(jClone); 
  } else {
    // 0 <=> bouton du haut 
    $("#contenu").prepend(jClone);
  }
}
</script>

<body>
<p>Bienvenue dans mon application</p>
<input type="button" class="boutonAfficherCacher" value="Afficher"/>
<input type="text" class="controle"/>

<div id="contenu">
  <p>P1</p>
  <p>P2</p>
  <p>P3</p>
</div><p></p>
<input type="button" class="boutonAfficherCacher" value="Afficher"/>
<input type="text" class="controle"/>
</body>


